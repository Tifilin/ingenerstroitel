<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расчёт снеговой нагрузки по СП 20.13330.2016 с учётом горных районов</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 15px; 
            line-height: 1.4;
            color: #333;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            font-size: 14px;
        }
        .steps-container {
            position: relative;
        }
        .step { 
            margin-bottom: 20px; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 6px;
            background: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: none;
        }
        .step.active {
            display: block;
        }
        .step h2 { 
            color: #2c3e50; 
            margin-top: 0;
            border-bottom: 1px solid #3498db;
            padding-bottom: 8px;
            font-size: 18px;
        }
        img { 
            max-width: 100%; 
            height: auto; 
            display: block; 
            margin: 10px auto;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        select, input { 
            padding: 6px 8px; 
            margin: 5px 3px; 
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
        }
        button { 
            padding: 8px 16px; 
            background: #3498db; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: background 0.3s;
        }
        button:hover { 
            background: #2980b9; 
        }
        #report { 
            display: none; 
            margin-top: 20px; 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 6px;
            border-left: 3px solid #3498db;
        }
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 10px 0; 
            background: white;
            font-size: 13px;
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 8px; 
            text-align: left; 
        }
        th { 
            background-color: #f2f2f2; 
            font-weight: bold;
        }
        #roofImage { 
            max-width: 400px; 
        }
        .italic { 
            font-style: italic; 
            font-weight: normal; 
            color: #7f8c8d;
            font-size: 12px;
        }
        #snowMap, #sp131Table { 
            display: none; 
        }
        #ceValue, #muValue { 
            font-weight: bold; 
            color: #e74c3c; 
            font-size: 14px;
        }
        .terrain-type { 
            display: block; 
            margin-bottom: 5px; 
            padding: 6px;
            background: #f8f9fa;
            border-radius: 3px;
            font-size: 13px;
        }
        .method-label { 
            display: block; 
            margin-bottom: 6px; 
            padding: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        .method-label input {
            margin-right: 6px;
        }
        #sgDisplay { 
            font-weight: bold; 
            color: #2ecc71; 
            font-size: 14px;
        }
        .zone-table {
            margin: 10px 0;
            background: #ecf0f1;
            padding: 10px;
            border-radius: 4px;
        }
        .scheme-toggle {
            margin: 8px 0;
        }
        .scheme-toggle button {
            padding: 6px 12px;
            margin-right: 8px;
            background: #95a5a6;
            font-size: 12px;
        }
        .scheme-toggle button.active {
            background: #3498db;
        }
        .calculation-formula {
            background: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .note {
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            padding: 8px;
            margin: 10px 0;
            border-radius: 3px;
            font-size: 12px;
        }
        .warning {
            background: #f8d7da;
            border-left: 3px solid #dc3545;
            padding: 8px;
            margin: 10px 0;
            border-radius: 3px;
            font-size: 12px;
        }
        .info {
            background: #d1ecf1;
            border-left: 3px solid #17a2b8;
            padding: 8px;
            margin: 10px 0;
            border-radius: 3px;
            font-size: 12px;
        }
        .algorithm {
            background: #d1ecf1;
            border-left: 3px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            font-size: 13px;
        }
        .roof-scheme {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }
        .scheme-diagram {
            flex: 1;
            min-width: 280px;
            background: white;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .scheme-values {
            flex: 1;
            min-width: 280px;
        }
        .temperature-control {
            background: #e8f5e8;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .calculation-method {
            margin: 8px 0;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .calculation-method label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            font-size: 13px;
        }
        .sp-calculation {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .manual-input {
            margin-top: 12px;
        }
        .city-temperature {
            background: #e8f5e8;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 10px;
            border-radius: 4px;
            margin: 15px 0;
            font-size: 12px;
            text-align: center;
        }
        .feedback-link {
            float: right;
            font-size: 12px;
            color: #7f8c8d;
            margin-top: -5px;
        }
        .feedback-link a {
            color: #3498db;
            text-decoration: none;
        }
        .feedback-link a:hover {
            text-decoration: underline;
        }
        .snow-height-info {
            background: #e8f5e8;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 12px;
        }
        .mu-manual-option {
            margin-top: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .detailed-explanation {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 12px;
        }
        .report-actions {
            margin: 15px 0;
            text-align: center;
        }
        .report-actions button {
            margin: 0 10px;
        }
        .btn-print {
            background: #e74c3c;
        }
        .btn-print:hover {
            background: #c0392b;
        }
        .btn-reset {
            background: #95a5a6;
        }
        .btn-reset:hover {
            background: #7f8c8d;
        }
        .mu-scheme {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .mu-zone {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 3px;
        }
        .scheme-description {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 12px;
        }
        .zone-calculation {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .load-result {
            background: #2c3e50;
            color: white;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            font-family: 'Courier New', monospace;
        }
        .scheme-usage {
            background: #fff3cd;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 12px;
        }
        .dimension-error {
            background: #f8d7da;
            color: #721c24;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 3px solid #dc3545;
            font-size: 12px;
        }
        .step-navigation {
            margin-top: 20px;
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .btn-prev {
            background: #95a5a6;
            margin-right: 10px;
        }
        .btn-prev:hover {
            background: #7f8c8d;
        }
        .btn-next {
            background: #3498db;
        }
        .btn-next:hover {
            background: #2980b9;
        }
        .btn-calculate {
            background: #27ae60;
            padding: 12px 24px;
            font-size: 16px;
        }
        .btn-calculate:hover {
            background: #219a52;
        }
        .mountain-control {
            background: #e8f4fd;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid #3498db;
        }
        .mountain-table {
            margin: 10px 0;
            background: white;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .mountain-table table {
            margin: 0;
        }
        .mountain-table th {
            background: #3498db;
            color: white;
        }
        .altitude-input {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .kb-display {
            background: #2c3e50;
            color: white;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #report, #report * {
                visibility: visible;
            }
            #report {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
                box-shadow: none;
            }
            .report-actions {
                display: none;
            }
            .step-navigation {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="feedback-link">
        Обратная связь: <a href="https://dzen.ru/ingenerstroitel" target="_blank">dzen.ru/ingenerstroitel</a>
    </div>
    
    <h1>🏔️🧮 Расчёт снеговой нагрузки по СП 20.13330.2016 с учётом горных районов</h1>
    
    <div class="disclaimer">
        <strong>Внимание:</strong> Данный калькулятор предоставляет справочный расчёт и был настроен в соответствии с нормами СП 20.13330.2016. 
        Стоит проверять актуальность СП и результаты расчёта.
    </div>

    <div class="steps-container">
        <!-- Шаг 1 -->
        <div class="step active" id="step1">
            <h2>📊 Шаг 1: Нормативная снеговая нагрузка Sg и температура</h2>
            <p class="italic">Sg, п. 10.2; Температура для п. 10.11</p>
            
            <div class="calculation-method">
                <label>Способ определения Sg:</label>
                <label class="method-label">
                    <input type="radio" name="sgMethod" value="manual" checked onchange="toggleSgMethod()"> 
                    ✏️ Ввести значение вручную
                </label>
                <label class="method-label">
                    <input type="radio" name="sgMethod" value="sp" onchange="toggleSgMethod()"> 
                    📖 Рассчитать по СП 20.13330.2016
                </label>
            </div>

            <div id="sgManualInput" class="manual-input">
                <label>Нормативная снеговая нагрузка Sg (кПа): 
                    <input type="number" id="sgManual" step="0.1" value="1.8" min="0">
                </label>
                <p class="note">Уточненное Sg (по данным Росгидромета, кПа, если объект на границе районов или в сложном рельефе)</p>
            </div>

            <div id="sgSpCalculation" class="sp-calculation">
                <p><strong>Способ определения по СП 20.13330.2016:</strong></p>
                <label class="method-label">
                    <input type="radio" name="spMethod" value="city" checked onchange="showSpMethod('city')"> 
                    🏙️ По населенному пункту
                </label>
                <label class="method-label">
                    <input type="radio" name="spMethod" value="map" onchange="showSpMethod('map')"> 
                    📍 По карте снеговых районов
                </label>

                <div id="cityMethod">
                    <label>Населенный пункт: 
                        <select id="citySelect" onchange="setFromCity()">
                            <option value="">Выберите город</option>
                            <option value="Москва" data-temp="-7.7" data-district="III">Москва</option>
                            <option value="Санкт-Петербург" data-temp="-5.5" data-district="III">Санкт-Петербург</option>
                            <option value="Екатеринбург" data-temp="-12.6" data-district="IV">Екатеринбург</option>
                            <option value="Новосибирск" data-temp="-16.2" data-district="V">Новосибирск</option>
                            <option value="Нижний Новгород" data-temp="-8.9" data-district="IV">Нижний Новгород</option>
                            <option value="Казань" data-temp="-9.8" data-district="IV">Казань</option>
                            <option value="Самара" data-temp="-9.5" data-district="IV">Самара</option>
                            <option value="Омск" data-temp="-16.3" data-district="IV">Омск</option>
                            <option value="Челябинск" data-temp="-12.8" data-district="IV">Челябинск</option>
                            <option value="Ростов-на-Дону" data-temp="-3.1" data-district="III">Ростов-на-Дону</option>
                            <option value="Уфа" data-temp="-12.5" data-district="V">Уфа</option>
                            <option value="Волгоград" data-temp="-6.7" data-district="III">Волгоград</option>
                            <option value="Пермь" data-temp="-12.8" data-district="V">Пермь</option>
                            <option value="Красноярск" data-temp="-15.6" data-district="IV">Красноярск</option>
                            <option value="Воронеж" data-temp="-6.5" data-district="III">Воронеж</option>
                            <option value="Саратов" data-temp="-7.9" data-district="III">Саратов</option>
                            <option value="Краснодар" data-temp="-0.3" data-district="II">Краснодар</option>
                            <option value="Тольятти" data-temp="-9.2" data-district="IV">Тольятти</option>
                            <option value="Ижевск" data-temp="-12.5" data-district="V">Ижевск</option>
                            <option value="Барнаул" data-temp="-15.5" data-district="IV">Барнаул</option>
                            <option value="Ульяновск" data-temp="-10.1" data-district="IV">Ульяновск</option>
                            <option value="Иркутск" data-temp="-17.8" data-district="II">Иркутск</option>
                            <option value="Хабаровск" data-temp="-20.9" data-district="II">Хабаровск</option>
                            <option value="Ярославль" data-temp="-8.9" data-district="IV">Ярославль</option>
                            <option value="Владивосток" data-temp="-9.9" data-district="IV">Владивосток</option>
                            <option value="Махачкала" data-temp="1.2" data-district="II">Махачкала</option>
                            <option value="Томск" data-temp="-17.1" data-district="IV">Томск</option>
                            <option value="Кемерово" data-temp="-15.8" data-district="IV">Кемерово</option>
                            <option value="Новокузнецк" data-temp="-14.2" data-district="IV">Новокузнецк</option>
                            <option value="Сочи" data-temp="5.0" data-district="II">Сочи</option>
                            <option value="Якутск" data-temp="-39.6" data-district="VII">Якутск</option>
                            <option value="Мурманск" data-temp="-8.1" data-district="V">Мурманск</option>
                            <option value="Архангельск" data-temp="-12.8" data-district="V">Архангельск</option>
                            <option value="Калининград" data-temp="-1.5" data-district="II">Калининград</option>
                            <option value="Владикавказ" data-temp="-1.2" data-district="II">Владикавказ</option>
                            <option value="Грозный" data-temp="-2.1" data-district="II">Грозный</option>
                            <option value="Ставрополь" data-temp="-2.3" data-district="III">Ставрополь</option>
                            <option value="Петрозаводск" data-temp="-9.0" data-district="IV">Петрозаводск</option>
                            <option value="Сыктывкар" data-temp="-14.1" data-district="V">Сыктывкар</option>
                            <option value="Нальчик" data-temp="-2.5" data-district="II">Нальчик</option>
                            <option value="Черкесск" data-temp="-2.8" data-district="II">Черкесск</option>
                            <option value="Магас" data-temp="-1.8" data-district="II">Магас</option>
                            <option value="Магадан" data-temp="-16.4" data-district="VI">Магадан</option>
                            <option value="Салехард" data-temp="-23.0" data-district="VI">Салехард</option>
                            <option value="Нарьян-Мар" data-temp="-16.5" data-district="VI">Нарьян-Мар</option>
                            <option value="Анадырь" data-temp="-22.1" data-district="VII">Анадырь</option>
                            <option value="Петропавловск-Камчатский" data-temp="-7.6" data-district="VIII">Петропавловск-Камчатский</option>
                        </select>
                    </label>
                    <p id="sgDisplay">Sg: <span id="sgValue">1.8</span> кПа</p>
                </div>

                <div id="mapMethod" style="display: none;">
                    <label>Выберите карту: 
                        <select id="mapType" onchange="updateMapSrc()">
                            <option value="main">Основная Россия</option>
                            <option value="krym">Крым</option>
                            <option value="sakhalin">Сахалин</option>
                        </select>
                    </label>
                    <br>
                    <button type="button" id="mapToggleBtn" onclick="toggleMap('snowMap')">🗺️ Показать карту</button>
                    <img id="snowMap" src="https://saitinpro.ru/wp-content/uploads/2018/03/Karta-1_sneg.gif" alt="Карта снеговых районов России по СП 20.13330.2016" style="display: none;">
                    <label>Выбранный снеговой район: 
                        <select id="snowDistrictMap" onchange="updateSgFromMap()">
                            <option value="I">I (0.8 кПа)</option>
                            <option value="II">II (1.2 кПа)</option>
                            <option value="III">III (1.8 кПа)</option>
                            <option value="IV">IV (2.4 кПа)</option>
                            <option value="V">V (3.2 кПа)</option>
                            <option value="VI">VI (4.0 кПа)</option>
                            <option value="VII">VII (5.6 кПа)</option>
                            <option value="VIII">VIII (7.0 кПа)</option>
                        </select>
                    </label>
                </div>

                <div class="note">
                    <label>Уточненное Sg (по данным Росгидромета, кПа): 
                        <input type="number" id="customSg" step="0.1" placeholder="Оставить пустым для табличного">
                    </label>
                    <p class="italic">Используется если объект на границе районов или в сложном рельефе</p>
                </div>
            </div>

            <!-- Горные районы -->
            <div class="mountain-control">
                <h3>🏔️ Учёт высотного коэффициента для горных районов (Таблица Ж.1 СП 20.13330.2016)</h3>
                <label class="method-label">
                    <input type="checkbox" id="mountainArea" onchange="toggleMountainArea()">
                    🗻 Применить высотный коэффициент k_b для горных районов
                </label>
                
                <div id="mountainCalculation" style="display: none;">
                    <div class="altitude-input">
                        <label>Высота расположения объекта над уровнем моря H (м): 
                            <input type="number" id="altitude" min="0" max="5000" value="500" onchange="updateKb()">
                        </label>
                        <p class="italic">Введите высоту расположения объекта над уровнем моря</p>
                    </div>
                    
                    <label>Выберите горный район: 
                        <select id="mountainRegion" onchange="updateKb()">
                            <option value="">Выберите район</option>
                            <option value="dagestan">Республика Дагестан</option>
                            <option value="krasnodar_adler">Краснодарский край: Адлерский район</option>
                            <option value="krasnodar_apsheron">Краснодарский край: Апшеронский и Лазаревский районы</option>
                            <option value="krasnodar_tuapse">Краснодарский край: Туапсинский район</option>
                            <option value="krasnodar_other">Краснодарский край: Остальные районы</option>
                            <option value="stavropol">Ставропольский край</option>
                            <option value="evenkia">Эвенкийский автономный округ</option>
                            <option value="krasnoyarsk_kuznetsk">Красноярский край: Кемеровская область, Кузнецкий Алатау, Горная Шория</option>
                            <option value="krasnoyarsk_sayan">Красноярский край: Саянский хр., Куртушибинский хр.</option>
                            <option value="krasnoyarsk_north">Красноярский край: Северо-Енисейский район</option>
                            <option value="buryatia_khamar">Республика Бурятия, хр. Хамар-Дабам</option>
                            <option value="buryatia_baikal">Республика Бурятия, Байкальский хр.</option>
                            <option value="yakutia_aldan">Республика Якутия, Алданское нагорье</option>
                        </select>
                    </label>
                    
                    <div id="kbCalculationDetails"></div>
                    <div id="kbDisplay" class="kb-display"></div>
                    
                    <div class="mountain-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Территориальный район РФ</th>
                                    <th>Снеговой район</th>
                                    <th>k_b</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Республика Дагестан</td><td>II</td><td>0,001</td></tr>
                                <tr><td>Краснодарский Край: Адлерский район</td><td>III</td><td>0,009</td></tr>
                                <tr><td>Краснодарский Край: Апшеронский и Лазаревский районы</td><td>II</td><td>0,008</td></tr>
                                <tr><td>Краснодарский Край: Туапсинский район</td><td>II</td><td>0,005</td></tr>
                                <tr><td>Краснодарский Край: Остальные районы</td><td>II</td><td>0,003</td></tr>
                                <tr><td>Ставропольский Край</td><td>II</td><td>0,001</td></tr>
                                <tr><td>Эвенкийский автономный округ</td><td>VI</td><td>0,001</td></tr>
                                <tr><td>Красноярский Край: Кемеровская область, Кузнецкий Алатау, Горная Шория</td><td>VI, VII</td><td>0,0068</td></tr>
                                <tr><td>Красноярский Край: Саянский хр., Куртушибинский хр.</td><td>IV</td><td>0,0063</td></tr>
                                <tr><td>Красноярский Край: Северо-Енисейский район</td><td>VI</td><td>0,0028</td></tr>
                                <tr><td>Республика Бурятия, хр. Хамар-Дабам</td><td>IV</td><td>0,002</td></tr>
                                <tr><td>Республика Бурятия, Байкальский хр.</td><td>IV</td><td>0,0046</td></tr>
                                <tr><td>Республика Якутия, Алданское нагорье</td><td>III</td><td>0,002</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Температура января -->
            <div id="temperatureControl" class="temperature-control">
                <label>🌡️ Среднемесячная температура января: 
                    <select id="januaryTemp" onchange="updateTemperatureInfo()">
                        <option value="unknown">Не определена</option>
                        <option value="cold">≤ -5°C (холодная зима)</option>
                        <option value="warm">> -5°C (теплая зима)</option>
                    </select>
                </label>
                <p class="italic">
                    Значение средней температуры наиболее холодного месяца (января) можно посмотреть в 
                    <a href="https://docs.cntd.ru/document/1200175796" target="_blank" class="sp-link">таблице 7.1 СП 131.13330.2020</a>
                </p>
                
                <div id="temperatureInfo">
                    <!-- Информация о температуре будет заполняться здесь -->
                </div>
            </div>

            <div class="step-navigation">
                <button type="button" class="btn-next" onclick="nextStep(2)">Далее →</button>
            </div>
        </div>

        <!-- Шаг 2 -->
        <div class="step" id="step2">
            <h2>🌄 Шаг 2: Коэффициент воздействия ветра Ce</h2>
            <p class="italic">п. 10.5-10.9</p>
            
            <div class="calculation-method">
                <label>Способ определения Ce:</label>
                <label class="method-label">
                    <input type="radio" name="ceMethod" value="manual" checked onchange="toggleCeMethod()"> 
                    ✏️ Ввести значение вручную
                </label>
                <label class="method-label">
                    <input type="radio" name="ceMethod" value="sp" onchange="toggleCeMethod()"> 
                    📖 Рассчитать по СП 20.13330.2016
                </label>
            </div>

            <div id="ceManualInput" class="manual-input">
                <label>Коэффициент воздействия ветра Ce: 
                    <input type="number" id="ceManual" step="0.01" value="1.0" min="0.5" max="1.0">
                </label>
            </div>

            <div id="ceSpCalculation" class="sp-calculation">
                <p><strong>Тип местности:</strong></p>
                <p class="terrain-type">🌊 A - открытые побережья морей, озер и водохранилищ, пустыни, степи, лесостепи, тундра;</p>
                <p class="terrain-type">🏘️ B - городские территории, лесные массивы и другие местности, равномерно покрытые препятствиями высотой более 10 м;</p>
                <p class="terrain-type">🏙️ C - городские районы с застройкой зданиями высотой более 25 м.</p>
                
                <label>Тип местности: 
                    <select id="terrainType" onchange="updateCe()">
                        <option value="A">A (открытая)</option>
                        <option value="B" selected>B (с препятствиями)</option>
                        <option value="C">C (городская)</option>
                    </select>
                </label>
                
                <label>🏠 Защищено от ветра? (соседние здания, лес и т.п.): 
                    <input type="checkbox" id="protected" onchange="updateCe()">
                </label>

                <div id="dimSection">
                    <p><strong>Размеры покрытия для расчета сноса снега:</strong></p>
                    <label>Наименьший размер в плане l (м): <input type="number" id="dimMin" value="50" min="0" onchange="updateCe()"></label>
                    <label>Наибольший размер в плане L (м): <input type="number" id="dimMax" value="50" min="0" onchange="updateCe()"></label>
                    <div id="dimensionError" class="dimension-error" style="display: none;">
                        ❌ Ошибка: Наименьший размер не может быть больше наибольшего размера. Пожалуйста, исправьте значения.
                    </div>
                </div>

                <p id="ceValue">Рассчитанное значение Ce: 1.0</p>
                <div id="ceCalculationDetails"></div>
            </div>

            <div class="step-navigation">
                <button type="button" class="btn-prev" onclick="prevStep(1)">← Назад</button>
                <button type="button" class="btn-next" onclick="nextStep(3)">Далее →</button>
            </div>
        </div>

        <!-- Шаг 3 -->
        <div class="step" id="step3">
            <h2>🔥 Шаг 3: Термический коэффициент Ct</h2>
            <p class="italic">п. 10.10-10.11</p>
            
            <div class="calculation-method">
                <label>Способ определения Ct:</label>
                <label class="method-label">
                    <input type="radio" name="ctMethod" value="manual" checked onchange="toggleCtMethod()"> 
                    ✏️ Ввести значение вручную
                </label>
                <label class="method-label">
                    <input type="radio" name="ctMethod" value="sp" onchange="toggleCtMethod()"> 
                    📖 Рассчитать по СП 20.13330.2016
                </label>
            </div>

            <div id="ctManualInput" class="manual-input">
                <label>Термический коэффициент Ct: 
                    <input type="number" id="ctManual" step="0.01" value="1.0" min="0.8" max="1.2">
                </label>
            </div>

            <div id="ctSpCalculation" class="sp-calculation">
                <p><strong>Выберите тип покрытия:</strong></p>
                <label class="method-label">
                    <input type="radio" name="ctType" value="normal" checked onchange="updateCt()"> 
                    🏠 Обычное покрытие с утеплением
                </label>
                <label class="method-label">
                    <input type="radio" name="ctType" value="transparent" onchange="updateCt()"> 
                    ☀️ Прозрачные покрытия (с коэффициентом теплопередачи > 1 Вт/(м²·°C))
                </label>
                <label class="method-label">
                    <input type="radio" name="ctType" value="highLoss" onchange="updateCt()"> 
                    ❄️ Покрытия с повышенными тепловыми потерями
                </label>
                <label class="method-label">
                    <input type="radio" name="ctType" value="cold" onchange="updateCt()"> 
                    🏭 Холодные покрытия (с коэффициентом теплопередачи ≤ 1 Вт/(м²·°C))
                </label>
                
                <div id="ctValue">Рассчитанное значение Ct: 1.0</div>
                <div id="ctCalculationDetails"></div>
            </div>

            <div class="step-navigation">
                <button type="button" class="btn-prev" onclick="prevStep(2)">← Назад</button>
                <button type="button" class="btn-next" onclick="nextStep(4)">Далее →</button>
            </div>
        </div>

        <!-- Шаг 4 -->
        <div class="step" id="step4">
            <h2>🏠 Шаг 4: Коэффициент перехода μ и схема нагрузки</h2>
            <p class="italic">п. 10.4, Приложение Ж</p>
            
            <div class="calculation-method">
                <label>Способ определения μ:</label>
                <label class="method-label">
                    <input type="radio" name="muMethod" value="sp" checked onchange="toggleMuMethod()"> 
                    📖 Рассчитать по СП 20.13330.2016
                </label>
                <label class="method-label">
                    <input type="radio" name="muMethod" value="manual" onchange="toggleMuMethod()"> 
                    ✏️ Ввести значение вручную
                </label>
            </div>

            <div id="muManualInput" class="manual-input mu-manual-option" style="display: none;">
                <label>Коэффициент перехода μ: 
                    <input type="number" id="muManual" step="0.01" value="1.0" min="0">
                </label>
            </div>

            <div id="muSpCalculation">
                <p><strong>Выберите тип покрытия:</strong></p>
                <select id="roofType" onchange="showRoofScheme()">
                    <option value="flat">Плоские покрытия (уклон ≤ 12° или ≤ 21%)</option>
                    <option value="single">Односкатные покрытия</option>
                    <option value="double">Двускатные покрытия</option>
                    <option value="mansard">Ломаные (мансардные) покрытия</option>
                    <option value="vaulted">Сводчатые и близкие к ним по очертанию покрытия</option>
                    <option value="conical">Конические покрытия круговых очертаний</option>
                </select>

                <div id="roofScheme"></div>
                
                <div id="muValue">Рассчитанное значение μ: 1.0</div>
                <div id="muCalculationDetails"></div>
            </div>

            <div class="step-navigation">
                <button type="button" class="btn-prev" onclick="prevStep(3)">← Назад</button>
                <button type="button" class="btn-next" onclick="nextStep(5)">Далее →</button>
            </div>
        </div>

        <!-- Шаг 5 -->
        <div class="step" id="step5">
            <h2>🧮 Шаг 5: Расчёт и результаты</h2>
            
            <div class="calculation-formula">
                <strong>Расчётная формула:</strong> S = Sg × k_b × μ × Ce × Ct × γf
            </div>
            
            <div class="info">
                <strong>Исходные данные:</strong>
                <div id="inputData"></div>
            </div>
            
            <div class="info">
                <strong>Коэффициенты:</strong>
                <div id="coefficientsData"></div>
            </div>
            
            <div class="algorithm">
                <strong>Алгоритм расчёта:</strong>
                <div id="calculationAlgorithm"></div>
            </div>
            
            <div class="report-actions">
                <button type="button" class="btn-calculate" onclick="calculateSnowLoad()">🧮 Рассчитать снеговую нагрузку</button>
            </div>
            
            <div id="report"></div>
            
            <div class="step-navigation">
                <button type="button" class="btn-prev" onclick="prevStep(4)">← Назад</button>
            </div>
        </div>
    </div>

    <script>
        // Глобальные переменные для хранения данных
        let currentStep = 1;
        let sgValue = 1.8;
        let ceValue = 1.0;
        let ctValue = 1.0;
        let muValue = 1.0;
        let kbValue = 1.0;
        let gammaF = 1.4;
        let isMountainArea = false;
        let altitude = 500;
        let mountainRegion = '';
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            updateSgFromMap();
            updateCe();
            updateCt();
            showRoofScheme();
            updateKb();
        });
        
        // Навигация по шагам
        function nextStep(step) {
            document.getElementById('step' + currentStep).classList.remove('active');
            currentStep = step;
            document.getElementById('step' + currentStep).classList.add('active');
        }
        
        function prevStep(step) {
            document.getElementById('step' + currentStep).classList.remove('active');
            currentStep = step;
            document.getElementById('step' + currentStep).classList.add('active');
        }
        
        // Переключение методов определения Sg
        function toggleSgMethod() {
            const manualMethod = document.querySelector('input[name="sgMethod"]:checked').value === 'manual';
            document.getElementById('sgManualInput').style.display = manualMethod ? 'block' : 'none';
            document.getElementById('sgSpCalculation').style.display = manualMethod ? 'none' : 'block';
            
            if (!manualMethod) {
                showSpMethod('city');
            }
        }
        
        // Показать метод определения по СП
        function showSpMethod(method) {
            document.getElementById('cityMethod').style.display = method === 'city' ? 'block' : 'none';
            document.getElementById('mapMethod').style.display = method === 'map' ? 'none' : 'block';
        }
        
        // Обновление карты
        function updateMapSrc() {
            const mapType = document.getElementById('mapType').value;
            const snowMap = document.getElementById('snowMap');
            
            if (mapType === 'main') {
                snowMap.src = 'https://saitinpro.ru/wp-content/uploads/2018/03/Karta-1_sneg.gif';
            } else if (mapType === 'krym') {
                snowMap.src = 'https://saitinpro.ru/wp-content/uploads/2018/03/Karta-1_sneg_krym.gif';
            } else if (mapType === 'sakhalin') {
                snowMap.src = 'https://saitinpro.ru/wp-content/uploads/2018/03/Karta-1_sneg_sahal.gif';
            }
        }
        
        // Переключение видимости карты
        function toggleMap(mapId) {
            const map = document.getElementById(mapId);
            const btn = document.getElementById('mapToggleBtn');
            
            if (map.style.display === 'none') {
                map.style.display = 'block';
                btn.textContent = '🗺️ Скрыть карту';
            } else {
                map.style.display = 'none';
                btn.textContent = '🗺️ Показать карту';
            }
        }
        
        // Установка значений из выбранного города
        function setFromCity() {
            const citySelect = document.getElementById('citySelect');
            const selectedOption = citySelect.options[citySelect.selectedIndex];
            
            if (selectedOption.value) {
                const temp = selectedOption.getAttribute('data-temp');
                const district = selectedOption.getAttribute('data-district');
                
                // Установка снегового района
                const sgValues = {
                    'I': 0.8, 'II': 1.2, 'III': 1.8, 'IV': 2.4, 
                    'V': 3.2, 'VI': 4.0, 'VII': 5.6, 'VIII': 7.0
                };
                
                sgValue = sgValues[district];
                document.getElementById('sgValue').textContent = sgValue;
                
                // Установка температуры
                document.getElementById('januaryTemp').value = parseFloat(temp) <= -5 ? 'cold' : 'warm';
                updateTemperatureInfo();
            }
        }
        
        // Обновление Sg из карты
        function updateSgFromMap() {
            const district = document.getElementById('snowDistrictMap').value;
            const sgValues = {
                'I': 0.8, 'II': 1.2, 'III': 1.8, 'IV': 2.4, 
                'V': 3.2, 'VI': 4.0, 'VII': 5.6, 'VIII': 7.0
            };
            
            sgValue = sgValues[district];
            document.getElementById('sgValue').textContent = sgValue;
        }
        
        // Обновление информации о температуре
        function updateTemperatureInfo() {
            const tempSelect = document.getElementById('januaryTemp');
            const tempInfo = document.getElementById('temperatureInfo');
            
            if (tempSelect.value === 'unknown') {
                tempInfo.innerHTML = '<div class="warning">⚠️ Температура не определена. Для точного расчета Ct рекомендуется определить температуру.</div>';
            } else if (tempSelect.value === 'cold') {
                tempInfo.innerHTML = '<div class="info">❄️ Холодная зима (≤ -5°C). Учитывается при расчете Ct для покрытий с повышенными тепловыми потерями.</div>';
            } else {
                tempInfo.innerHTML = '<div class="info">🌡️ Теплая зима (> -5°C). Учитывается при расчете Ct для покрытий с повышенными тепловыми потерями.</div>';
            }
        }
        
        // Переключение методов определения Ce
        function toggleCeMethod() {
            const manualMethod = document.querySelector('input[name="ceMethod"]:checked').value === 'manual';
            document.getElementById('ceManualInput').style.display = manualMethod ? 'block' : 'none';
            document.getElementById('ceSpCalculation').style.display = manualMethod ? 'none' : 'block';
            
            if (!manualMethod) {
                updateCe();
            }
        }
        
        // Обновление Ce
        function updateCe() {
            const terrainType = document.getElementById('terrainType').value;
            const isProtected = document.getElementById('protected').checked;
            const dimMin = parseFloat(document.getElementById('dimMin').value) || 50;
            const dimMax = parseFloat(document.getElementById('dimMax').value) || 50;
            
            // Проверка корректности размеров
            if (dimMin > dimMax) {
                document.getElementById('dimensionError').style.display = 'block';
                return;
            } else {
                document.getElementById('dimensionError').style.display = 'none';
            }
            
            // Расчет Ce по СП 20.13330.2016
            let ce = 1.0;
            let calculationDetails = '';
            
            if (isProtected) {
                ce = 1.0;
                calculationDetails = 'Ce = 1.0 (место строительства защищено от ветра)';
            } else {
                // Расчет по формуле 10.1
                const k = terrainType === 'A' ? 0.3 : (terrainType === 'B' ? 0.4 : 0.5);
                const l = Math.min(dimMin, dimMax);
                const L = Math.max(dimMin, dimMax);
                
                if (l <= L && l <= 100) {
                    ce = 1.0;
                    calculationDetails = `Ce = 1.0 (l = ${l} м ≤ 100 м)`;
                } else if (l > 100 && l <= 200) {
                    ce = 1.2;
                    calculationDetails = `Ce = 1.2 (100 м < l = ${l} м ≤ 200 м)`;
                } else if (l > 200 && l <= 300) {
                    ce = 1.4;
                    calculationDetails = `Ce = 1.4 (200 м < l = ${l} м ≤ 300 м)`;
                } else if (l > 300) {
                    ce = 1.6;
                    calculationDetails = `Ce = 1.6 (l = ${l} м > 300 м)`;
                }
                
                // Учет типа местности
                if (terrainType === 'A') {
                    ce *= 0.8;
                    calculationDetails += ` × 0.8 (тип местности A) = ${ce.toFixed(2)}`;
                } else if (terrainType === 'C') {
                    ce *= 1.2;
                    calculationDetails += ` × 1.2 (тип местности C) = ${ce.toFixed(2)}`;
                } else {
                    calculationDetails += ` (тип местности B) = ${ce.toFixed(2)}`;
                }
            }
            
            ceValue = ce;
            document.getElementById('ceValue').textContent = `Рассчитанное значение Ce: ${ce.toFixed(2)}`;
            document.getElementById('ceCalculationDetails').innerHTML = `<div class="detailed-explanation">${calculationDetails}</div>`;
        }
        
        // Переключение методов определения Ct
        function toggleCtMethod() {
            const manualMethod = document.querySelector('input[name="ctMethod"]:checked').value === 'manual';
            document.getElementById('ctManualInput').style.display = manualMethod ? 'block' : 'none';
            document.getElementById('ctSpCalculation').style.display = manualMethod ? 'none' : 'block';
            
            if (!manualMethod) {
                updateCt();
            }
        }
        
        // Обновление Ct
        function updateCt() {
            const ctType = document.querySelector('input[name="ctType"]:checked').value;
            const tempSelect = document.getElementById('januaryTemp').value;
            
            let ct = 1.0;
            let calculationDetails = '';
            
            switch(ctType) {
                case 'normal':
                    ct = 1.0;
                    calculationDetails = 'Ct = 1.0 (обычное покрытие с утеплением)';
                    break;
                case 'transparent':
                    ct = 1.0;
                    calculationDetails = 'Ct = 1.0 (прозрачные покрытия)';
                    break;
                case 'highLoss':
                    if (tempSelect === 'cold') {
                        ct = 1.1;
                        calculationDetails = 'Ct = 1.1 (покрытия с повышенными тепловыми потерями, холодная зима ≤ -5°C)';
                    } else if (tempSelect === 'warm') {
                        ct = 1.2;
                        calculationDetails = 'Ct = 1.2 (покрытия с повышенными тепловыми потерями, теплая зима > -5°C)';
                    } else {
                        ct = 1.1;
                        calculationDetails = 'Ct = 1.1 (покрытия с повышенными тепловыми потерями, температура не определена - принято по холодной зиме)';
                    }
                    break;
                case 'cold':
                    ct = 1.2;
                    calculationDetails = 'Ct = 1.2 (холодные покрытия с коэффициентом теплопередачи ≤ 1 Вт/(м²·°C))';
                    break;
            }
            
            ctValue = ct;
            document.getElementById('ctValue').textContent = `Рассчитанное значение Ct: ${ct.toFixed(2)}`;
            document.getElementById('ctCalculationDetails').innerHTML = `<div class="detailed-explanation">${calculationDetails}</div>`;
        }
        
        // Переключение методов определения μ
        function toggleMuMethod() {
            const manualMethod = document.querySelector('input[name="muMethod"]:checked').value === 'manual';
            document.getElementById('muManualInput').style.display = manualMethod ? 'block' : 'none';
            document.getElementById('muSpCalculation').style.display = manualMethod ? 'none' : 'block';
            
            if (!manualMethod) {
                showRoofScheme();
            }
        }
        
        // Показать схему крыши
        function showRoofScheme() {
            const roofType = document.getElementById('roofType').value;
            const roofScheme = document.getElementById('roofScheme');
            
            let schemeHTML = '';
            let mu = 1.0;
            let calculationDetails = '';
            
            switch(roofType) {
                case 'flat':
                    schemeHTML = `
                        <div class="roof-scheme">
                            <div class="scheme-diagram">
                                <h4>📐 Схема плоского покрытия</h4>
                                <div style="text-align: center; margin: 10px 0;">
                                    <div style="background: #ddd; height: 30px; width: 200px; margin: 0 auto; position: relative;">
                                        <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%);">α ≤ 12°</div>
                                    </div>
                                    <div style="margin-top: 10px;">Плоское покрытие</div>
                                </div>
                            </div>
                            <div class="scheme-values">
                                <h4>📊 Коэффициенты μ</h4>
                                <div class="mu-zone">
                                    <strong>Вся площадь покрытия:</strong> μ = 1.0
                                </div>
                                <div class="scheme-usage">
                                    <strong>Применение:</strong> Для уклонов ≤ 12° или ≤ 21%
                                </div>
                            </div>
                        </div>
                    `;
                    mu = 1.0;
                    calculationDetails = 'μ = 1.0 (плоские покрытия с уклоном ≤ 12°)';
                    break;
                    
                case 'single':
                    schemeHTML = `
                        <div class="roof-scheme">
                            <div class="scheme-diagram">
                                <h4>📐 Схема односкатного покрытия</h4>
                                <div style="text-align: center; margin: 10px 0;">
                                    <div style="background: linear-gradient(to bottom right, #ddd 50%, #eee 50%); height: 100px; width: 200px; margin: 0 auto; position: relative;">
                                        <div style="position: absolute; top: 10px; left: 10px;">α</div>
                                        <div style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);">L</div>
                                    </div>
                                </div>
                                <label>Угол наклона α (°): <input type="number" id="singleSlope" value="30" min="0" max="60" onchange="updateSingleSlopeMu()"></label>
                                <label>Длина ската L (м): <input type="number" id="singleLength" value="10" min="1" onchange="updateSingleSlopeMu()"></label>
                            </div>
                            <div class="scheme-values">
                                <h4>📊 Коэффициенты μ</h4>
                                <div id="singleMuZones"></div>
                            </div>
                        </div>
                    `;
                    updateSingleSlopeMu();
                    break;
                    
                case 'double':
                    schemeHTML = `
                        <div class="roof-scheme">
                            <div class="scheme-diagram">
                                <h4>📐 Схема двускатного покрытия</h4>
                                <div style="text-align: center; margin: 10px 0;">
                                    <div style="background: linear-gradient(to bottom, #ddd 50%, #eee 50%); height: 100px; width: 200px; margin: 0 auto; position: relative;">
                                        <div style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%);">α</div>
                                        <div style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);">L</div>
                                        <div style="position: absolute; top: 50%; left: 10px; transform: translateY(-50%);">μ₁</div>
                                        <div style="position: absolute; top: 50%; right: 10px; transform: translateY(-50%);">μ₂</div>
                                    </div>
                                </div>
                                <label>Угол наклона α (°): <input type="number" id="doubleSlope" value="30" min="0" max="60" onchange="updateDoubleSlopeMu()"></label>
                                <label>Длина ската L (м): <input type="number" id="doubleLength" value="10" min="1" onchange="updateDoubleSlopeMu()"></label>
                            </div>
                            <div class="scheme-values">
                                <h4>📊 Коэффициенты μ</h4>
                                <div id="doubleMuZones"></div>
                            </div>
                        </div>
                    `;
                    updateDoubleSlopeMu();
                    break;
                    
                // Другие типы покрытий можно добавить аналогично
                default:
                    schemeHTML = `<div class="info">Выбранный тип покрытия в разработке. Используется μ = 1.0</div>`;
                    mu = 1.0;
                    calculationDetails = 'μ = 1.0 (по умолчанию для выбранного типа покрытия)';
            }
            
            roofScheme.innerHTML = schemeHTML;
            muValue = mu;
            
            if (calculationDetails) {
                document.getElementById('muValue').textContent = `Рассчитанное значение μ: ${mu.toFixed(2)}`;
                document.getElementById('muCalculationDetails').innerHTML = `<div class="detailed-explanation">${calculationDetails}</div>`;
            }
        }
        
        // Обновление μ для односкатного покрытия
        function updateSingleSlopeMu() {
            const slope = parseFloat(document.getElementById('singleSlope').value) || 30;
            const length = parseFloat(document.getElementById('singleLength').value) || 10;
            
            let mu1, mu2;
            let calculationDetails = '';
            
            if (slope <= 30) {
                mu1 = 1.0;
                mu2 = 1.0;
                calculationDetails = `μ = 1.0 (уклон α = ${slope}° ≤ 30°)`;
            } else if (slope > 30 && slope <= 60) {
                mu1 = (60 - slope) / 30;
                mu2 = (60 - slope) / 30;
                calculationDetails = `μ = (60 - ${slope}) / 30 = ${mu1.toFixed(2)} (уклон α = ${slope}° > 30° и ≤ 60°)`;
            } else {
                mu1 = 0;
                mu2 = 0;
                calculationDetails = `μ = 0 (уклон α = ${slope}° > 60°)`;
            }
            
            // Учет длины ската для образования снегового мешка
            if (slope > 15 && slope <= 30 && length > 6) {
                mu2 = 1.5;
                calculationDetails += `<br>На нижней части ската μ = 1.5 (образование снегового мешка при L = ${length} м > 6 м)`;
            }
            
            document.getElementById('singleMuZones').innerHTML = `
                <div class="mu-zone">
                    <strong>Верхняя часть ската:</strong> μ = ${mu1.toFixed(2)}
                </div>
                <div class="mu-zone">
                    <strong>Нижняя часть ската:</strong> μ = ${mu2.toFixed(2)}
                </div>
            `;
            
            muValue = Math.max(mu1, mu2);
            document.getElementById('muValue').textContent = `Рассчитанное значение μ: ${muValue.toFixed(2)}`;
            document.getElementById('muCalculationDetails').innerHTML = `<div class="detailed-explanation">${calculationDetails}</div>`;
        }
        
        // Обновление μ для двускатного покрытия
        function updateDoubleSlopeMu() {
            const slope = parseFloat(document.getElementById('doubleSlope').value) || 30;
            const length = parseFloat(document.getElementById('doubleLength').value) || 10;
            
            let mu1, mu2, mu3;
            let calculationDetails = '';
            
            if (slope <= 30) {
                mu1 = 0.8;
                mu2 = 1.0;
                mu3 = 0.8;
                calculationDetails = `μ₁ = 0.8, μ₂ = 1.0, μ₃ = 0.8 (уклон α = ${slope}° ≤ 30°)`;
            } else if (slope > 30 && slope <= 60) {
                mu1 = 0.8 * (60 - slope) / 30;
                mu2 = (60 - slope) / 30;
                mu3 = 0.8 * (60 - slope) / 30;
                calculationDetails = `μ₁ = 0.8 × (60 - ${slope}) / 30 = ${mu1.toFixed(2)}, μ₂ = (60 - ${slope}) / 30 = ${mu2.toFixed(2)}, μ₃ = 0.8 × (60 - ${slope}) / 30 = ${mu3.toFixed(2)} (уклон α = ${slope}° > 30° и ≤ 60°)`;
            } else {
                mu1 = 0;
                mu2 = 0;
                mu3 = 0;
                calculationDetails = `μ = 0 (уклон α = ${slope}° > 60°)`;
            }
            
            // Учет длины ската для образования снегового мешка в ендове
            if (slope > 15 && slope <= 30 && length > 6) {
                mu2 = 1.5;
                calculationDetails += `<br>В ендове μ = 1.5 (образование снегового мешка при L = ${length} м > 6 м)`;
            }
            
            document.getElementById('doubleMuZones').innerHTML = `
                <div class="mu-zone">
                    <strong>Левый скат (верх):</strong> μ = ${mu1.toFixed(2)}
                </div>
                <div class="mu-zone">
                    <strong>Ендова (центр):</strong> μ = ${mu2.toFixed(2)}
                </div>
                <div class="mu-zone">
                    <strong>Правый скат (верх):</strong> μ = ${mu3.toFixed(2)}
                </div>
            `;
            
            muValue = Math.max(mu1, mu2, mu3);
            document.getElementById('muValue').textContent = `Рассчитанное значение μ: ${muValue.toFixed(2)}`;
            document.getElementById('muCalculationDetails').innerHTML = `<div class="detailed-explanation">${calculationDetails}</div>`;
        }
        
        // Переключение учета горных районов
        function toggleMountainArea() {
            isMountainArea = document.getElementById('mountainArea').checked;
            document.getElementById('mountainCalculation').style.display = isMountainArea ? 'block' : 'none';
            
            if (!isMountainArea) {
                kbValue = 1.0;
                document.getElementById('kbDisplay').innerHTML = '';
            } else {
                updateKb();
            }
        }
        
        // Обновление высотного коэффициента k_b
        function updateKb() {
            if (!isMountainArea) return;
            
            altitude = parseFloat(document.getElementById('altitude').value) || 500;
            mountainRegion = document.getElementById('mountainRegion').value;
            
            let kb = 1.0;
            let calculationDetails = '';
            
            // Коэффициенты из Таблицы Ж.1 СП 20.13330.2016
            const regionCoefficients = {
                'dagestan': 0.001,
                'krasnodar_adler': 0.009,
                'krasnodar_apsheron': 0.008,
                'krasnodar_tuapse': 0.005,
                'krasnodar_other': 0.003,
                'stavropol': 0.001,
                'evenkia': 0.001,
                'krasnoyarsk_kuznetsk': 0.0068,
                'krasnoyarsk_sayan': 0.0063,
                'krasnoyarsk_north': 0.0028,
                'buryatia_khamar': 0.002,
                'buryatia_baikal': 0.0046,
                'yakutia_aldan': 0.002
            };
            
            if (mountainRegion && regionCoefficients[mountainRegion]) {
                const coefficient = regionCoefficients[mountainRegion];
                kb = 1 + coefficient * altitude;
                calculationDetails = `k_b = 1 + ${coefficient} × ${altitude} = ${kb.toFixed(3)}`;
                
                document.getElementById('kbCalculationDetails').innerHTML = `
                    <div class="detailed-explanation">
                        <strong>Расчет высотного коэффициента:</strong><br>
                        ${calculationDetails}
                    </div>
                `;
                
                document.getElementById('kbDisplay').innerHTML = `
                    <div class="kb-display">
                        Высотный коэффициент k_b = ${kb.toFixed(3)}
                    </div>
                `;
            } else {
                calculationDetails = 'k_b = 1.0 (район не выбран)';
                document.getElementById('kbCalculationDetails').innerHTML = `
                    <div class="warning">
                        ⚠️ Высотный коэффициент не рассчитан. Выберите горный район для расчета.
                    </div>
                `;
                document.getElementById('kbDisplay').innerHTML = '';
            }
            
            kbValue = kb;
        }
        
        // Основная функция расчета снеговой нагрузки
        function calculateSnowLoad() {
            // Получение значений из формы
            const sgMethod = document.querySelector('input[name="sgMethod"]:checked').value;
            if (sgMethod === 'manual') {
                sgValue = parseFloat(document.getElementById('sgManual').value) || 1.8;
            } else {
                const customSg = document.getElementById('customSg').value;
                if (customSg && !isNaN(customSg)) {
                    sgValue = parseFloat(customSg);
                }
                // Иначе используется значение, установленное ранее
            }
            
            const ceMethod = document.querySelector('input[name="ceMethod"]:checked').value;
            if (ceMethod === 'manual') {
                ceValue = parseFloat(document.getElementById('ceManual').value) || 1.0;
            }
            
            const ctMethod = document.querySelector('input[name="ctMethod"]:checked').value;
            if (ctMethod === 'manual') {
                ctValue = parseFloat(document.getElementById('ctManual').value) || 1.0;
            }
            
            const muMethod = document.querySelector('input[name="muMethod"]:checked').value;
            if (muMethod === 'manual') {
                muValue = parseFloat(document.getElementById('muManual').value) || 1.0;
            }
            
            // Расчет снеговой нагрузки
            const S = sgValue * kbValue * muValue * ceValue * ctValue * gammaF;
            
            // Формирование отчета
            const report = document.getElementById('report');
            report.style.display = 'block';
            
            // Формирование входных данных
            document.getElementById('inputData').innerHTML = `
                <div>Sg = ${sgValue.toFixed(2)} кПа (нормативная снеговая нагрузка)</div>
                ${isMountainArea ? `<div>H = ${altitude} м (высота над уровнем моря)</div>` : ''}
                <div>μ = ${muValue.toFixed(2)} (коэффициент перехода)</div>
                <div>Ce = ${ceValue.toFixed(2)} (коэффициент воздействия ветра)</div>
                <div>Ct = ${ctValue.toFixed(2)} (термический коэффициент)</div>
                <div>γf = ${gammaF.toFixed(1)} (коэффициент надежности)</div>
                ${isMountainArea ? `<div>k_b = ${kbValue.toFixed(3)} (высотный коэффициент)</div>` : ''}
            `;
            
            // Формирование данных по коэффициентам
            document.getElementById('coefficientsData').innerHTML = `
                <div>Нормативная снеговая нагрузка: Sg = ${sgValue.toFixed(2)} кПа</div>
                ${isMountainArea ? `<div>Высотный коэффициент: k_b = ${kbValue.toFixed(3)}</div>` : '<div>Высотный коэффициент: k_b = 1.0 (не применяется)</div>'}
                <div>Коэффициент перехода: μ = ${muValue.toFixed(2)}</div>
                <div>Коэффициент воздействия ветра: Ce = ${ceValue.toFixed(2)}</div>
                <div>Термический коэффициент: Ct = ${ctValue.toFixed(2)}</div>
                <div>Коэффициент надежности: γf = ${gammaF.toFixed(1)}</div>
            `;
            
            // Формирование алгоритма расчета
            let algorithmHTML = `
                <div>1. Нормативная снеговая нагрузка: Sg = ${sgValue.toFixed(2)} кПа</div>
            `;
            
            if (isMountainArea) {
                algorithmHTML += `
                    <div>2. Высотный коэффициент: k_b = ${kbValue.toFixed(3)}</div>
                    <div>3. Коэффициент перехода: μ = ${muValue.toFixed(2)}</div>
                    <div>4. Коэффициент воздействия ветра: Ce = ${ceValue.toFixed(2)}</div>
                    <div>5. Термический коэффициент: Ct = ${ctValue.toFixed(2)}</div>
                    <div>6. Коэффициент надежности: γf = ${gammaF.toFixed(1)}</div>
                    <div class="calculation-formula">
                        7. Расчётная снеговая нагрузка: S = Sg × k_b × μ × Ce × Ct × γf = 
                        ${sgValue.toFixed(2)} × ${kbValue.toFixed(3)} × ${muValue.toFixed(2)} × ${ceValue.toFixed(2)} × ${ctValue.toFixed(2)} × ${gammaF.toFixed(1)} = ${S.toFixed(3)} кПа
                    </div>
                `;
            } else {
                algorithmHTML += `
                    <div>2. Коэффициент перехода: μ = ${muValue.toFixed(2)}</div>
                    <div>3. Коэффициент воздействия ветра: Ce = ${ceValue.toFixed(2)}</div>
                    <div>4. Термический коэффициент: Ct = ${ctValue.toFixed(2)}</div>
                    <div>5. Коэффициент надежности: γf = ${gammaF.toFixed(1)}</div>
                    <div class="calculation-formula">
                        6. Расчётная снеговая нагрузка: S = Sg × μ × Ce × Ct × γf = 
                        ${sgValue.toFixed(2)} × ${muValue.toFixed(2)} × ${ceValue.toFixed(2)} × ${ctValue.toFixed(2)} × ${gammaF.toFixed(1)} = ${S.toFixed(3)} кПа
                    </div>
                `;
            }
            
            document.getElementById('calculationAlgorithm').innerHTML = algorithmHTML;
            
            // Формирование итогового отчета
            report.innerHTML = `
                <h2>📋 Результаты расчёта снеговой нагрузки</h2>
                
                <div class="info">
                    <h3>📊 Исходные данные</h3>
                    <div>Нормативная снеговая нагрузка Sg = ${sgValue.toFixed(2)} кПа</div>
                    ${isMountainArea ? `<div>Высота над уровнем моря H = ${altitude} м</div>` : ''}
                    <div>Коэффициент перехода μ = ${muValue.toFixed(2)}</div>
                    <div>Коэффициент воздействия ветра Ce = ${ceValue.toFixed(2)}</div>
                    <div>Термический коэффициент Ct = ${ctValue.toFixed(2)}</div>
                    <div>Коэффициент надежности γf = ${gammaF.toFixed(1)}</div>
                    ${isMountainArea ? `<div>Высотный коэффициент k_b = ${kbValue.toFixed(3)}</div>` : ''}
                </div>
                
                <div class="algorithm">
                    <h3>🧮 Алгоритм расчёта</h3>
                    ${algorithmHTML}
                </div>
                
                <div class="load-result">
                    <h3>🎯 Итоговые значения снеговой нагрузки</h3>
                    <div><strong>Нормативная снеговая нагрузка:</strong> S₀ = Sg × μ = ${sgValue.toFixed(2)} × ${muValue.toFixed(2)} = ${(sgValue * muValue).toFixed(3)} кПа</div>
                    <div><strong>Расчётная снеговая нагрузка:</strong> S = ${S.toFixed(3)} кПа</div>
                    <div><strong>Расчётная снеговая нагрузка:</strong> S = ${(S * 100).toFixed(1)} кг/м²</div>
                </div>
                
                ${isMountainArea ? `
                <div class="mountain-control">
                    <h3>🏔️ Учёт высотного коэффициента для горных районов</h3>
                    <div>Применён высотный коэффициент k_b = ${kbValue.toFixed(3)} для ${document.getElementById('mountainRegion').options[document.getElementById('mountainRegion').selectedIndex].text}</div>
                    <div>Высота расположения объекта: ${altitude} м над уровнем моря</div>
                </div>
                ` : ''}
                
                <div class="report-actions">
                    <button type="button" class="btn-print" onclick="window.print()">🖨️ Печать отчёта</button>
                    <button type="button" class="btn-reset" onclick="resetCalculator()">🔄 Новый расчёт</button>
                </div>
                
                <div class="disclaimer">
                    <strong>Примечание:</strong> Данный расчёт выполнен в соответствии с СП 20.13330.2016 "Нагрузки и воздействия". 
                    Для ответственных конструкций рекомендуется выполнять проверочные расчёты и консультации с проектировщиком.
                </div>
            `;
            
            // Прокрутка к отчету
            report.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Сброс калькулятора
        function resetCalculator() {
            location.reload();
        }
    </script>
</body>
</html>
