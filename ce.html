<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—á–µ—Ç Ce - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è –≤–µ—Ç—Ä–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåÑ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è –≤–µ—Ç—Ä–∞ Ce</h1>
            <p class="subtitle">–ø. 10.5-10.9 –°–ü 20.13330.2016 —Å –ò–∑–º–µ–Ω–µ–Ω–∏–µ–º ‚Ññ5</p>
        </div>

        <div class="content-card">
            <div class="method-selector">
                <label class="method-option">
                    <input type="radio" name="ceMethod" value="manual" checked>
                    <span class="radio-label">‚úèÔ∏è –í–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é</span>
                </label>
                <label class="method-option">
                    <input type="radio" name="ceMethod" value="auto">
                    <span class="radio-label">üìñ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ –°–ü (–ò–∑–º–µ–Ω–µ–Ω–∏–µ ‚Ññ5)</span>
                </label>
            </div>

            <div id="manual-input" class="input-section">
                <label>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è –≤–µ—Ç—Ä–∞ Ce:</label>
                <input type="number" id="ceManual" value="1.0" step="0.01" min="0.5" max="1.0">
                <p class="note">–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: –æ—Ç 0.5 –¥–æ 1.0</p>
            </div>

            <div id="auto-input" class="input-section" style="display: none;">
                <!-- –ó–∞—â–∏—Ç–∞ –æ—Ç –≤–µ—Ç—Ä–∞ -->
                <div class="input-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="protected">
                        üè† –û–±—ä–µ–∫—Ç –∑–∞—â–∏—â–µ–Ω –æ—Ç –ø—Ä—è–º–æ–≥–æ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è –≤–µ—Ç—Ä–∞
                    </label>
                    <p class="note">–ø.10.6: —Å–æ—Å–µ–¥–Ω–∏–µ –∑–¥–∞–Ω–∏—è, –ª–µ—Å, —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π</p>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                <div class="parameters-grid">
                    <div class="param-group">
                        <label>–¢–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è:</label>
                        <select id="roofTypeCe">
                            <option value="flat">–ü–ª–æ—Å–∫–æ–µ</option>
                            <option value="single_slope">–û–¥–Ω–æ—Å–∫–∞—Ç–Ω–æ–µ</option>
                            <option value="pitched">–î–≤—É—Å–∫–∞—Ç–Ω–æ–µ</option>
                            <option value="arched">–°–≤–æ–¥—á–∞—Ç–æ–µ</option>
                        </select>
                    </div>

                    <div class="param-group">
                        <label>–£–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ Œ± (¬∞):</label>
                        <input type="number" id="roofAngleCe" value="15" min="0" max="90">
                    </div>

                    <div class="param-group">
                        <label>–†–∞–∑–º–µ—Ä—ã –ø–æ–∫—Ä—ã—Ç–∏—è (–º):</label>
                        <div class="dimensions">
                            <input type="number" id="dimWidth" placeholder="–®–∏—Ä–∏–Ω–∞" value="10" min="1">
                            <span>√ó</span>
                            <input type="number" id="dimLength" placeholder="–î–ª–∏–Ω–∞" value="20" min="1">
                        </div>
                    </div>

                    <div class="param-group">
                        <label>–í—ã—Å–æ—Ç–∞ –∑–¥–∞–Ω–∏—è (–º):</label>
                        <input type="number" id="buildingHeight" value="5" min="1" step="0.1">
                    </div>
                </div>

                <!-- –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                <div class="climate-params">
                    <h3>üå°Ô∏è –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                    
                    <div class="param-group">
                        <label>–¢–∏–ø –º–µ—Å—Ç–Ω–æ—Å—Ç–∏:</label>
                        <select id="terrainType">
                            <option value="A">A - –æ—Ç–∫—Ä—ã—Ç–∞—è –º–µ—Å—Ç–Ω–æ—Å—Ç—å</option>
                            <option value="B" selected>B - –≥–æ—Ä–æ–¥—Å–∫–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è</option>
                            <option value="C">C - –≥–æ—Ä–æ–¥—Å–∫–∞—è –∑–∞—Å—Ç—Ä–æ–π–∫–∞</option>
                        </select>
                    </div>

                    <div class="param-group">
                        <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —è–Ω–≤–∞—Ä—è (¬∞C):</label>
                        <input type="number" id="januaryTemp" value="-8" step="0.1">
                    </div>

                    <div class="param-group">
                        <label>–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ –∑–∏–º–æ–π (–º/—Å):</label>
                        <input type="number" id="windSpeed" value="4.0" step="0.1" min="0">
                    </div>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞ -->
                <div class="calculation-result">
                    <div class="result-header">
                        <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞ Ce</h3>
                    </div>
                    
                    <div id="ce-calculation-details">
                        <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</p>
                    </div>
                    
                    <div class="final-result">
                        <strong>Ce = <span id="ce-result">1.0</span></strong>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn-secondary" onclick="goToStep('sg.html')">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="btn-primary" onclick="saveCe()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí</button>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script src="data.js"></script>
    <script src="calculations.js"></script>
    <script>
        let currentCe = 1.0;

        function initPage() {
            loadSavedData();
            setupEventListeners();
            calculateCe();
        }

        function setupEventListeners() {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤
            document.querySelectorAll('input[name="ceMethod"]').forEach(radio => {
                radio.addEventListener('change', toggleMethod);
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            const autoInputs = [
                'protected', 'roofTypeCe', 'roofAngleCe', 'dimWidth', 'dimLength',
                'buildingHeight', 'terrainType', 'januaryTemp', 'windSpeed'
            ];
            
            autoInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', calculateCe);
                    element.addEventListener('change', calculateCe);
                }
            });
        }

        function toggleMethod() {
            const method = document.querySelector('input[name="ceMethod"]:checked').value;
            document.getElementById('manual-input').style.display = method === 'manual' ? 'block' : 'none';
            document.getElementById('auto-input').style.display = method === 'auto' ? 'block' : 'none';
            
            if (method === 'auto') {
                calculateCe();
            }
        }

        function calculateCe() {
            const method = document.querySelector('input[name="ceMethod"]:checked').value;
            
            if (method === 'manual') {
                currentCe = parseFloat(document.getElementById('ceManual').value) || 1.0;
                showManualResult();
                return;
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø–æ –Ω–æ–≤—ã–º –ø—Ä–∞–≤–∏–ª–∞–º
            const isProtected = document.getElementById('protected').checked;
            
            if (isProtected) {
                currentCe = 1.0;
                showProtectedResult();
                return;
            }
            
            const params = {
                roofType: document.getElementById('roofTypeCe').value,
                angle: parseFloat(document.getElementById('roofAngleCe').value) || 15,
                dimensions: {
                    width: parseFloat(document.getElementById('dimWidth').value) || 10,
                    length: parseFloat(document.getElementById('dimLength').value) || 20
                },
                terrainType: document.getElementById('terrainType').value,
                isProtected: false,
                januaryTemp: parseFloat(document.getElementById('januaryTemp').value) || -8,
                windSpeed: parseFloat(document.getElementById('windSpeed').value) || 4.0,
                buildingHeight: parseFloat(document.getElementById('buildingHeight').value) || 5
            };
            
            const result = calculateCeNewRules(params);
            currentCe = result.ce;
            showAutoCalculationResult(result);
        }

        function showManualResult() {
            document.getElementById('ce-result').textContent = currentCe.toFixed(2);
            document.getElementById('ce-calculation-details').innerHTML = `
                <div class="protocol-step">
                    <div class="protocol-description"><strong>–ú–µ—Ç–æ–¥:</strong> –†—É—á–Ω–æ–π –≤–≤–æ–¥</div>
                    <div class="protocol-description"><strong>–ó–Ω–∞—á–µ–Ω–∏–µ Ce:</strong> ${currentCe.toFixed(2)}</div>
                </div>
            `;
        }

        function showProtectedResult() {
            document.getElementById('ce-result').textContent = currentCe.toFixed(2);
            document.getElementById('ce-calculation-details').innerHTML = `
                <div class="protocol-step">
                    <div class="protocol-description"><strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong> –ø.10.6 –°–ü 20.13330.2016</div>
                    <div class="protocol-description">–û–±—ä–µ–∫—Ç –∑–∞—â–∏—â–µ–Ω –æ—Ç –ø—Ä—è–º–æ–≥–æ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è –≤–µ—Ç—Ä–∞</div>
                    <div class="protocol-formula">Ce = 1.0</div>
                </div>
            `;
        }

        function showAutoCalculationResult(result) {
            document.getElementById('ce-result').textContent = result.ce.toFixed(2);
            
            let details = `
                <div class="protocol-step">
                    <div class="protocol-description"><strong>–ú–µ—Ç–æ–¥ —Ä–∞—Å—á–µ—Ç–∞:</strong> ${getMethodDescription(result.method)}</div>
            `;
            
            if (result.details) {
                if (result.details.reason) {
                    details += `<div class="protocol-description"><strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong> ${result.details.reason}</div>`;
                }
                
                if (result.details.lc !== undefined) {
                    details += `
                        <div class="protocol-description"><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä:</strong> lc = ${result.details.lc.toFixed(2)} –º</div>
                        <div class="protocol-description"><strong>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç kv:</strong> ${result.details.kv.toFixed(2)}</div>
                        <div class="protocol-description"><strong>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç k:</strong> ${result.details.k.toFixed(2)}</div>
                        <div class="protocol-formula">
                            ${result.details.formula}<br>
                            Ce = ${result.details.calculatedCe.toFixed(3)} ‚Üí ${result.ce.toFixed(2)}
                        </div>
                    `;
                }
            }
            
            details += `</div>`;
            document.getElementById('ce-calculation-details').innerHTML = details;
        }

        function getMethodDescription(method) {
            const methods = {
                'protected': '–ø.10.6 - –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç',
                'warm_region': '–ø.10.9–∞ - —Ç–µ–ø–ª—ã–π —Ä–µ–≥–∏–æ–Ω',
                'default': '–ø.10.5 - –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ',
                'formula_10_2': '–ø.10.7 - —Ñ–æ—Ä–º—É–ª–∞ 10.2'
            };
            return methods[method] || method;
        }

        function loadSavedData() {
            const data = getCalculationData();
            
            if (data.ceMethod) {
                document.querySelector(`input[name="ceMethod"][value="${data.ceMethod}"]`).checked = true;
            }
            toggleMethod();
            
            if (data.ce) {
                document.getElementById('ceManual').value = data.ce;
                currentCe = data.ce;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –µ—Å–ª–∏ –µ—Å—Ç—å
            const params = [
                'protected', 'roofTypeCe', 'roofAngleCe', 'dimWidth', 'dimLength',
                'buildingHeight', 'terrainType', 'januaryTemp', 'windSpeed'
            ];
            
            params.forEach(param => {
                if (data[param] !== undefined) {
                    const element = document.getElementById(param);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = data[param];
                        } else {
                            element.value = data[param];
                        }
                    }
                }
            });
            
            calculateCe();
        }

        function saveCe() {
            const method = document.querySelector('input[name="ceMethod"]:checked').value;
            
            const saveData = {
                ce: currentCe,
                ceMethod: method
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
            if (method === 'auto') {
                const params = [
                    'protected', 'roofTypeCe', 'roofAngleCe', 'dimWidth', 'dimLength',
                    'buildingHeight', 'terrainType', 'januaryTemp', 'windSpeed'
                ];
                
                params.forEach(param => {
                    const element = document.getElementById(param);
                    if (element) {
                        saveData[param] = element.type === 'checkbox' ? element.checked : element.value;
                    }
                });
            }
            
            updateCalculationData(saveData);
            showNotification('Ce —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            setTimeout(() => goToStep('ct.html'), 1000);
        }

        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>