<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—á–µ—Ç Sg - –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è —Å–Ω–µ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –®–∞–≥ 1: –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è —Å–Ω–µ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ Sg</h1>
            <p class="subtitle">–ø. 10.2, –¢–∞–±–ª–∏—Ü–∞ 10.1 –°–ü 20.13330.2016</p>
        </div>

        <div class="content-card">
            <!-- –¢–∞–±–ª–∏—Ü–∞ 10.1 –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ -->
            <div class="formula-table">
                <h3>–¢–∞–±–ª–∏—Ü–∞ 10.1 - –í–µ—Å —Å–Ω–µ–≥–æ–≤–æ–≥–æ –ø–æ–∫—Ä–æ–≤–∞ Sg</h3>
                <table>
                    <thead>
                        <tr>
                            <th>–°–Ω–µ–≥–æ–≤–æ–π —Ä–∞–π–æ–Ω</th>
                            <th>I</th>
                            <th>II</th>
                            <th>III</th>
                            <th>IV</th>
                            <th>V</th>
                            <th>VI</th>
                            <th>VII</th>
                            <th>VIII</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Sg, –∫–ü–∞</td>
                            <td>0.5</td>
                            <td>1.0</td>
                            <td>1.5</td>
                            <td>2.0</td>
                            <td>2.5</td>
                            <td>3.0</td>
                            <td>3.5</td>
                            <td>4.0</td>
                        </tr>
                        <tr>
                            <td>Sg, –∫–≥—Å/–º¬≤</td>
                            <td>50</td>
                            <td>100</td>
                            <td>150</td>
                            <td>200</td>
                            <td>250</td>
                            <td>300</td>
                            <td>350</td>
                            <td>400</td>
                        </tr>
                    </tbody>
                </table>
                <p class="table-reference">–¢–∞–±–ª–∏—Ü–∞ 10.1 –°–ü 20.13330.2016 —Å –ò–∑–º–µ–Ω–µ–Ω–∏–µ–º ‚Ññ5</p>
            </div>

            <div class="method-selector">
                <label class="method-option">
                    <input type="radio" name="sgMethod" value="manual" checked>
                    <span class="radio-label">‚úèÔ∏è –í–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é</span>
                </label>
                <label class="method-option">
                    <input type="radio" name="sgMethod" value="auto">
                    <span class="radio-label">üìñ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ –°–ü</span>
                </label>
            </div>

            <div id="manual-input" class="input-section">
                <div class="input-group">
                    <label>–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è —Å–Ω–µ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ Sg (–∫–ü–∞):</label>
                    <input type="number" id="sgManual" value="1.5" step="0.1" min="0.5" max="4.0">
                </div>
                <p class="note">–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–Ω–µ–≥–æ–≤–æ–º—É —Ä–∞–π–æ–Ω—É –ø–æ –¢–∞–±–ª–∏—Ü–µ 10.1</p>
            </div>

            <div id="auto-input" class="input-section" style="display: none;">
                <div class="method-selector">
                    <label class="method-option">
                        <input type="radio" name="spMethod" value="city" checked>
                        <span class="radio-label">üèôÔ∏è –ü–æ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–º—É –ø—É–Ω–∫—Ç—É</span>
                    </label>
                    <label class="method-option">
                        <input type="radio" name="spMethod" value="map">
                        <span class="radio-label">üìç –ü–æ –∫–∞—Ä—Ç–µ —Å–Ω–µ–≥–æ–≤—ã—Ö —Ä–∞–π–æ–Ω–æ–≤</span>
                    </label>
                </div>

                <div id="cityMethod">
                    <div class="input-group">
                        <label>–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç:</label>
                        <select id="citySelect">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                        </select>
                    </div>
                    
                    <div class="result-display">
                        <div class="result-item">
                            <span>–°–Ω–µ–≥–æ–≤–æ–π —Ä–∞–π–æ–Ω:</span>
                            <strong id="district-display">III</strong>
                        </div>
                        <div class="result-item">
                            <span>–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ Sg:</span>
                            <strong id="sg-display">1.5 –∫–ü–∞</strong>
                        </div>
                        <div class="result-item">
                            <span>–°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —è–Ω–≤–∞—Ä—è:</span>
                            <strong id="temp-display">-8.0¬∞C</strong>
                        </div>
                    </div>
                </div>

                <div id="mapMethod" style="display: none;">
                    <div class="input-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É: </label>
                        <select id="mapType">
                            <option value="main">–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏</option>
                            <option value="krym">–ö—Ä—ã–º—Å–∫–∏–π –ø–æ–ª—É–æ—Å—Ç—Ä–æ–≤</option>
                            <option value="sakhalin">–°–∞—Ö–∞–ª–∏–Ω –∏ –ö—É—Ä–∏–ª—ã</option>
                        </select>
                    </div>
                    
                    <button type="button" class="btn-info" id="toggleMapButton">
                        üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É —Å–Ω–µ–≥–æ–≤—ã—Ö —Ä–∞–π–æ–Ω–æ–≤
                    </button>
                    
                    <div id="mapContainer" style="display: none; margin-top: 15px;">
                        <img id="snowMap" src="" alt="–ö–∞—Ä—Ç–∞ —Å–Ω–µ–≥–æ–≤—ã—Ö —Ä–∞–π–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏ –ø–æ –°–ü 20.13330.2016" 
                             style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px;">
                        <p class="note">–ö–∞—Ä—Ç–∞ —Å–Ω–µ–≥–æ–≤—ã—Ö —Ä–∞–π–æ–Ω–æ–≤ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—é –ï –°–ü 20.13330.2016</p>
                    </div>
                    
                    <div class="input-group">
                        <label>–í—ã–±—Ä–∞–Ω–Ω—ã–π —Å–Ω–µ–≥–æ–≤–æ–π —Ä–∞–π–æ–Ω: </label>
                        <select id="snowDistrictMap">
                            <option value="I">I (0.5 –∫–ü–∞) - –Æ–∂–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                            <option value="II">II (1.0 –∫–ü–∞) - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                            <option value="III" selected>III (1.5 –∫–ü–∞) - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è</option>
                            <option value="IV">IV (2.0 –∫–ü–∞) - –£—Ä–∞–ª, –ó–∞–ø–∞–¥–Ω–∞—è –°–∏–±–∏—Ä—å</option>
                            <option value="V">V (2.5 –∫–ü–∞) - –í–æ—Å—Ç–æ—á–Ω–∞—è –°–∏–±–∏—Ä—å</option>
                            <option value="VI">VI (3.0 –∫–ü–∞) - –°–µ–≤–µ—Ä–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                            <option value="VII">VII (3.5 –∫–ü–∞) - –ü–æ–±–µ—Ä–µ–∂—å–µ –°–µ–≤–µ—Ä–Ω–æ–≥–æ –õ–µ–¥–æ–≤–∏—Ç–æ–≥–æ –æ–∫–µ–∞–Ω–∞</option>
                            <option value="VIII">VIII (4.0 –∫–ü–∞) - –ß—É–∫–æ—Ç–∫–∞, –æ—Å—Ç—Ä–æ–≤–∞ –°–µ–≤–µ—Ä–Ω–æ–≥–æ –õ–µ–¥–æ–≤–∏—Ç–æ–≥–æ –æ–∫–µ–∞–Ω–∞</option>
                        </select>
                    </div>
                </div>

                <div class="note">
                    <label>–£—Ç–æ—á–Ω–µ–Ω–Ω–æ–µ Sg (–ø–æ –¥–∞–Ω–Ω—ã–º –†–æ—Å–≥–∏–¥—Ä–æ–º–µ—Ç–∞, –∫–ü–∞): 
                        <input type="number" id="customSg" step="0.1" placeholder="–û—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –¥–ª—è —Ç–∞–±–ª–∏—á–Ω–æ–≥–æ">
                    </label>
                    <p class="italic">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Ä–∞–π–æ–Ω–æ–≤ –∏–ª–∏ –≤ —Å–ª–æ–∂–Ω–æ–º —Ä–µ–ª—å–µ—Ñ–µ (–ø.10.2 –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ 1)</p>
                </div>
            </div>

            <div class="actions">
                <button class="btn-secondary" id="backButton">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                <button class="btn-primary" id="saveButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí</button>
            </div>
        </div>

        <!-- –°–ø—Ä–∞–≤–∫–∞ –ø–æ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º -->
        <div class="reference-section">
            <h3>üìö –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
            <ul>
                <li>–°–ü 20.13330.2016 "–ù–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è" —Å –ò–∑–º–µ–Ω–µ–Ω–∏–µ–º ‚Ññ5</li>
                <li>–ø. 10.2 - –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è —Å–Ω–µ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</li>
                <li>–¢–∞–±–ª–∏—Ü–∞ 10.1 - –ó–Ω–∞—á–µ–Ω–∏—è –≤–µ—Å–æ–≤–æ–≥–æ –ø–æ–∫—Ä–æ–≤–∞ —Å–Ω–µ–≥–∞</li>
                <li>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ï - –ö–∞—Ä—Ç—ã —Ä–∞–π–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–§</li>
                <li>–°–ü 131.13330.2020 "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –∫–ª–∏–º–∞—Ç–æ–ª–æ–≥–∏—è"</li>
            </ul>
        </div>
    </div>

    <script src="common.js"></script>
    <script src="data.js"></script>
    <script>
        function initPage() {
            console.log('Initializing sg.html page');
            loadSavedData();
            setupEventListeners();
            initializeCitySelect();
            updateMapSrc();
            updateSgFromCity();
        }

        function setupEventListeners() {
            console.log('Setting up event listeners for sg.html');
            
            document.querySelectorAll('input[name="sgMethod"]').forEach(radio => {
                radio.addEventListener('change', toggleMethod);
            });
            
            document.querySelectorAll('input[name="spMethod"]').forEach(radio => {
                radio.addEventListener('change', toggleSpMethod);
            });
            
            document.getElementById('citySelect').addEventListener('change', updateSgFromCity);
            document.getElementById('snowDistrictMap').addEventListener('change', updateSgFromMap);
            document.getElementById('customSg').addEventListener('change', updateCustomSg);
            document.getElementById('toggleMapButton').addEventListener('click', toggleMap);
            document.getElementById('mapType').addEventListener('change', updateMapSrc);
            document.getElementById('backButton').addEventListener('click', () => goToStep('index.html'));
            document.getElementById('saveButton').addEventListener('click', saveSg);
        }

        function toggleMethod() {
            const method = document.querySelector('input[name="sgMethod"]:checked').value;
            document.getElementById('manual-input').style.display = method === 'manual' ? 'block' : 'none';
            document.getElementById('auto-input').style.display = method === 'auto' ? 'block' : 'none';
            
            if (method === 'auto') {
                toggleSpMethod();
            }
        }

        function toggleSpMethod() {
            const method = document.querySelector('input[name="spMethod"]:checked').value;
            document.getElementById('cityMethod').style.display = method === 'city' ? 'block' : 'none';
            document.getElementById('mapMethod').style.display = method === 'map' ? 'block' : 'none';
            
            if (method === 'map') {
                updateMapSrc();
            }
        }

        function initializeCitySelect() {
            const select = document.getElementById('citySelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
            
            Object.keys(CITIES_DATA).forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                select.appendChild(option);
            });
            
            select.value = '–ú–æ—Å–∫–≤–∞';
        }

        function updateSgFromCity() {
            const city = document.getElementById('citySelect').value;
            console.log('Updating Sg from city:', city);
            
            if (city && CITIES_DATA[city]) {
                const data = CITIES_DATA[city];
                const sg = SNOW_DISTRICTS[data.district];
                
                document.getElementById('district-display').textContent = data.district;
                document.getElementById('sg-display').textContent = `${sg} –∫–ü–∞`;
                document.getElementById('temp-display').textContent = `${data.temp}¬∞C`;
            }
        }

        function updateSgFromMap() {
            const district = document.getElementById('snowDistrictMap').value;
            const sg = SNOW_DISTRICTS[district];
        }

        function updateCustomSg() {
            const customSg = document.getElementById('customSg').value;
        }

        function toggleMap() {
            const mapContainer = document.getElementById('mapContainer');
            const btn = document.getElementById('toggleMapButton');
            
            if (mapContainer.style.display === 'none') {
                mapContainer.style.display = 'block';
                btn.textContent = 'üó∫Ô∏è –°–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É';
                updateMapSrc();
            } else {
                mapContainer.style.display = 'none';
                btn.textContent = 'üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É';
            }
        }

        function updateMapSrc() {
            const type = document.getElementById('mapType').value;
            const mapImg = document.getElementById('snowMap');
            
            if (!type || !mapImg) return;
            
            mapImg.src = MAP_URLS[type] || MAP_URLS.main;
            
            mapImg.onerror = function() {
                this.alt = '–ö–∞—Ä—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
            };
        }

        function loadSavedData() {
            const data = getCalculationData();
            console.log('Loading saved data for sg.html:', data);
            
            if (data.sgMethod) {
                document.querySelector(`input[name="sgMethod"][value="${data.sgMethod}"]`).checked = true;
            }
            if (data.spMethod) {
                document.querySelector(`input[name="spMethod"][value="${data.spMethod}"]`).checked = true;
            }
            
            toggleMethod();
            
            if (data.sg) {
                document.getElementById('sgManual').value = data.sg;
            }
            
            if (data.city) {
                document.getElementById('citySelect').value = data.city;
            } else {
                document.getElementById('citySelect').value = '–ú–æ—Å–∫–≤–∞';
            }
            updateSgFromCity();
            
            if (data.snowDistrictMap) {
                document.getElementById('snowDistrictMap').value = data.snowDistrictMap;
            }
            
            if (data.customSg) {
                document.getElementById('customSg').value = data.customSg;
            }
        }

        function saveSg() {
            console.log('Saving Sg data...');
            const method = document.querySelector('input[name="sgMethod"]:checked').value;
            let sg, city, snowDistrict, customSg, spMethod;
            
            if (method === 'manual') {
                sg = parseFloat(document.getElementById('sgManual').value);
                if (!sg || sg < 0.5 || sg > 4.0) {
                    showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ Sg –æ—Ç 0.5 –¥–æ 4.0 –∫–ü–∞', 'error');
                    return;
                }
            } else {
                spMethod = document.querySelector('input[name="spMethod"]:checked').value;
                
                if (spMethod === 'city') {
                    city = document.getElementById('citySelect').value;
                    if (!city) {
                        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç', 'error');
                        return;
                    }
                    sg = SNOW_DISTRICTS[CITIES_DATA[city].district];
                    snowDistrict = CITIES_DATA[city].district;
                } else {
                    snowDistrict = document.getElementById('snowDistrictMap').value;
                    sg = SNOW_DISTRICTS[snowDistrict];
                }
                
                customSg = document.getElementById('customSg').value;
                if (customSg) {
                    const customValue = parseFloat(customSg);
                    if (!isNaN(customValue) && customValue > 0) {
                        sg = Math.max(0.5, Math.min(4.0, customValue));
                    }
                }
            }
            
            const saveData = {
                sg: sg,
                sgMethod: method,
                spMethod: spMethod,
                city: city,
                snowDistrict: snowDistrict,
                snowDistrictMap: snowDistrict,
                customSg: customSg
            };
            
            console.log('Saving Sg data:', saveData);
            updateCalculationData(saveData);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            const verifyData = getCalculationData();
            console.log('Data after save in sg.html:', verifyData);
            
            if (verifyData.sg === sg) {
                showNotification('Sg —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
                goToStep('ce.html');
            } else {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è Sg!', 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>