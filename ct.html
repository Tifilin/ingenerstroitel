<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—á–µ—Ç Ct - –¢–µ—Ä–º–∏—á–µ—Å–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• –¢–µ—Ä–º–∏—á–µ—Å–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç Ct</h1>
            <p class="subtitle">–ø. 10.10 –°–ü 20.13330.2016</p>
        </div>

        <div class="content-card">
            <div class="method-selector">
                <label class="method-option">
                    <input type="radio" name="ctMethod" value="manual" checked>
                    <span class="radio-label">‚úèÔ∏è –í–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é</span>
                </label>
                <label class="method-option">
                    <input type="radio" name="ctMethod" value="auto">
                    <span class="radio-label">üìñ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ –°–ü</span>
                </label>
            </div>

            <div id="manual-input" class="input-section">
                <label>–¢–µ—Ä–º–∏—á–µ—Å–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç Ct:</label>
                <input type="number" id="ctManual" value="1.0" step="0.1" min="0.8" max="1.0">
                <p class="note">–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: –æ—Ç 0.8 –¥–æ 1.0</p>
            </div>

            <div id="auto-input" class="input-section" style="display: none;">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è:</h3>
                
                <div class="ct-options">
                    <label class="ct-option">
                        <input type="radio" name="ctType" value="normal" checked>
                        <div class="option-card">
                            <div class="option-icon">üè†</div>
                            <div class="option-content">
                                <strong>–û–±—ã—á–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è</strong>
                                <p>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫—Ä–æ–≤–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</p>
                                <div class="ct-value">Ct = 1.0</div>
                            </div>
                        </div>
                    </label>

                    <label class="ct-option">
                        <input type="radio" name="ctType" value="uninsulated">
                        <div class="option-card">
                            <div class="option-icon">üè≠</div>
                            <div class="option-content">
                                <strong>–ù–µ—É—Ç–µ–ø–ª–µ–Ω–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ —Ç–µ–ø–ª–æ–≤—ã–¥–µ–ª–µ–Ω–∏—è–º–∏</strong>
                                <p>–£–∫–ª–æ–Ω –∫—Ä–æ–≤–ª–∏ —Å–≤—ã—à–µ 3% —Å –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º –æ—Ç–≤–æ–¥–∞ –≤–æ–¥—ã</p>
                                <div class="ct-value">Ct = 0.8</div>
                            </div>
                        </div>
                    </label>
                </div>

                <div class="calculation-result">
                    <div class="result-header">
                        <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                    </div>
                    <div class="final-result">
                        <strong>Ct = <span id="ct-result">1.0</span></strong>
                    </div>
                    <div id="ct-calculation-details" class="protocol-step">
                        <div class="protocol-description">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn-secondary" id="backButton">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="btn-primary" id="saveButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí</button>
            </div>
        </div>

        <!-- –°–ø—Ä–∞–≤–∫–∞ –ø–æ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º -->
        <div class="reference-section">
            <h3>üìö –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
            <ul>
                <li>–°–ü 20.13330.2016 "–ù–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è" —Å –ò–∑–º–µ–Ω–µ–Ω–∏–µ–º ‚Ññ5</li>
                <li>–ø. 10.10 - –¢–µ—Ä–º–∏—á–µ—Å–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç Ct</li>
                <li>–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è —É—á–µ—Ç–∞ —Å–Ω–∏–∂–µ–Ω–∏—è —Å–Ω–µ–≥–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ –Ω–∞ –ø–æ–∫—Ä—ã—Ç–∏—è —Å –≤—ã—Å–æ–∫–∏–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º —Ç–µ–ø–ª–æ–ø–µ—Ä–µ–¥–∞—á–∏</li>
            </ul>
        </div>
    </div>

    <script src="common.js"></script>
    <script src="data.js"></script>
    <script>
        let currentCt = 1.0;

        function initPage() {
            console.log('Initializing ct.html page');
            loadSavedData();
            setupEventListeners();
            updateCtResult();
        }

        function setupEventListeners() {
            console.log('Setting up event listeners for ct.html');
            
            document.querySelectorAll('input[name="ctMethod"]').forEach(radio => {
                radio.addEventListener('change', toggleMethod);
            });
            
            document.querySelectorAll('input[name="ctType"]').forEach(radio => {
                radio.addEventListener('change', updateCtResult);
            });

            document.getElementById('backButton').addEventListener('click', () => goToStep('ce.html'));
            document.getElementById('saveButton').addEventListener('click', saveCt);
        }

        function toggleMethod() {
            const method = document.querySelector('input[name="ctMethod"]:checked').value;
            document.getElementById('manual-input').style.display = method === 'manual' ? 'block' : 'none';
            document.getElementById('auto-input').style.display = method === 'auto' ? 'block' : 'none';
            
            if (method === 'manual') {
                currentCt = parseFloat(document.getElementById('ctManual').value) || 1.0;
            } else {
                updateCtResult();
            }
        }

        function updateCtResult() {
            const method = document.querySelector('input[name="ctMethod"]:checked').value;
            
            if (method === 'manual') {
                currentCt = parseFloat(document.getElementById('ctManual').value) || 1.0;
                showManualResult();
                return;
            }
            
            const ctType = document.querySelector('input[name="ctType"]:checked').value;
            const ctValues = {
                'normal': 1.0,
                'uninsulated': 0.8
            };
            
            currentCt = ctValues[ctType] || 1.0;
            showAutoResult(ctType);
        }

        function showManualResult() {
            document.getElementById('ct-result').textContent = currentCt.toFixed(1);
            document.getElementById('ct-calculation-details').innerHTML = `
                <div class="protocol-description"><strong>–ú–µ—Ç–æ–¥:</strong> –†—É—á–Ω–æ–π –≤–≤–æ–¥</div>
                <div class="protocol-description"><strong>–ó–Ω–∞—á–µ–Ω–∏–µ Ct:</strong> ${currentCt.toFixed(1)}</div>
            `;
        }

        function showAutoResult(ctType) {
            document.getElementById('ct-result').textContent = currentCt.toFixed(1);
            
            const descriptions = {
                'normal': '–û–±—ã—á–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è',
                'uninsulated': '–ù–µ—É—Ç–µ–ø–ª–µ–Ω–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ —Ç–µ–ø–ª–æ–≤—ã–¥–µ–ª–µ–Ω–∏—è–º–∏'
            };
            
            const reasons = {
                'normal': '–ø.10.10: –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö Ct = 1.0',
                'uninsulated': '–ø.10.10: –î–ª—è –Ω–µ—É—Ç–µ–ø–ª–µ–Ω–Ω—ã—Ö –ø–æ–∫—Ä—ã—Ç–∏–π –∑–¥–∞–Ω–∏–π —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ —Ç–µ–ø–ª–æ–≤—ã–¥–µ–ª–µ–Ω–∏—è–º–∏, –ø—Ä–∏ —É–∫–ª–æ–Ω–µ –∫—Ä–æ–≤–ª–∏ —Å–≤—ã—à–µ 3% –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–∏ –æ—Ç–≤–æ–¥–∞ –≤–æ–¥—ã Ct = 0.8'
            };
            
            document.getElementById('ct-calculation-details').innerHTML = `
                <div class="protocol-description"><strong>–¢–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è:</strong> ${descriptions[ctType]}</div>
                <div class="protocol-description"><strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong> ${reasons[ctType]}</div>
                <div class="protocol-formula">Ct = ${currentCt.toFixed(1)}</div>
            `;
        }

        function loadSavedData() {
            const data = getCalculationData();
            console.log('Loading saved data for ct.html:', data);
            
            if (data.ctMethod) {
                document.querySelector(`input[name="ctMethod"][value="${data.ctMethod}"]`).checked = true;
            }
            
            if (data.ctType) {
                document.querySelector(`input[name="ctType"][value="${data.ctType}"]`).checked = true;
            }
            
            if (data.ct) {
                document.getElementById('ctManual').value = data.ct;
                currentCt = data.ct;
            }
            
            toggleMethod();
        }

        function saveCt() {
            console.log('Saving Ct data...');
            const method = document.querySelector('input[name="ctMethod"]:checked').value;
            const ctType = method === 'auto' ? document.querySelector('input[name="ctType"]:checked').value : null;
            
            const saveData = {
                ct: currentCt,
                ctMethod: method,
                ctType: ctType
            };
            
            console.log('Saving Ct data:', saveData);
            updateCalculationData(saveData);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            const verifyData = getCalculationData();
            console.log('Data after save in ct.html:', verifyData);
            
            if (verifyData.ct === currentCt) {
                showNotification('Ct —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
                goToStep('mu.html');
            } else {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è Ct!', 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>